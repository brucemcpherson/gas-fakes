# v2.1.0 - Multi-Backend Architecture and CLI Refactor

This version introduces a significant architectural shift to support multiple authentication backends (Google Workspace and Infomaniak KSuite) simultaneously or independently.

## Breaking Changes

### 1. Initialization and Authentication CLI
The `gas-fakes init` and `gas-fakes auth` commands have been refactored to be backend-agnostic.
- **`init` Refactor**: Now features a multi-select prompt to choose between Google and KSuite. Manual scope entry for ADC has been replaced by automatic discovery from `appsscript.json`.
- **`auth` Refactor**: Iterates through all platforms defined in your `.env` file. You can target a specific backend using `gas-fakes auth --backend ksuite`.
- **New Environment Variable**: `GF_PLATFORM_AUTH` is now used in `.env` to define the authorized platforms (comma-separated).

### 2. Multi-Platform Identity Management
The core `Auth` singleton now manages a map of identities rather than a single global user. 
- `Session.getActiveUser()` and `Session.getEffectiveUser()` now return identities matching the current `ScriptApp.__platform`.
- `ScriptApp.getOAuthToken()` dynamically returns the token for the active backend.

### 3. Lazy Store Initialization
`PropertiesService` and `CacheService` models (specifically those using Upstash) are now resolved lazily. This prevents premature authentication triggers when importing `gas-fakes`.

## New Features

- **Infomaniak KSuite Support**: Full integration for KSuite tokens. `DriveApp` can now switch to KSuite via `ScriptApp.__platform = 'ksuite'`.
- **Automated Scope Discovery**: `gas-fakes` now automatically reads your `appsscript.json` manifest to configure scopes for both DWD and ADC methods. 
    - **Note on ADC Sensitive Scopes**: If using ADC with sensitive/restricted scopes, ensure you provide an OAuth2 client credentials JSON file during `init` to avoid Google blocking the login process.
- **Enhanced Auth Reporting**: A single, concise summary report is now printed during startup, identifying exactly which backends are active and which authentication method (ADC/DWD/TOKEN) is being used.
- **Quiet Mode by Default**: Significantly reduced log noise during the startup phase.

## Technical Improvements

- **Recursive Loading Protection**: Improved Proxy logic in `ScriptApp` to prevent stack overflows during complex service cross-dependencies.
- **Main Thread Authorization Detection**: Fixed `Auth.hasAuth()` to correctly detect main-thread identity status, eliminating redundant worker initialization calls.
- **Dotenv Silence**: Suppressed the repetitive `dotenv` injection "tips" in the console output.
