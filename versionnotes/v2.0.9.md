
## v2.0.9

### Environment Variable Updates

Starting with v2.0.9, several updates have been made to how environment variables are handled and what variables are supported.

#### `GOOGLE_WORKSPACE_SUBJECT` (New)
This variable allows you to specify which Google Workspace user should be impersonated when using **Domain-Wide Delegation (DWD)**. 
- **Priority:** 
  1. `GOOGLE_WORKSPACE_SUBJECT` from `.env` or environment.
  2. The email of the user currently authenticated via `gcloud` (detected automatically).
- **Use Case:** This is particularly useful in Cloud Run or automated environments where you want the service account to act as a specific user, or when testing impersonation locally.

#### Node.js `--env-file` Support
`gas-fakes` now detects if you are using the native Node.js `--env-file` flag (available in Node 20.12+ and 21.7+). 
- If `--env-file` is detected, the CLI will skip its internal `dotenv` loading for the default `./.env` file. This prevents conflicts and ensures that the Node.js native loader is the source of truth.
- You can still use the `-e` or `--env` CLI flag to point to a specific file, which will continue to use `dotenv` for compatibility across all supported Node versions.

#### Refined Auth Steering
The logic for determining the authentication method (`ADC` vs `DWD`) has been refined. If `AUTH_TYPE` is not explicitly set, `gas-fakes` will automatically select `DWD` if `GOOGLE_SERVICE_ACCOUNT_NAME` is found in your environment, ensuring a seamless experience for users moving to keyless DWD.

### Other Improvements in v2.0.9

- **DWD Reliability:** The `sxRetry` logic now explicitly handles "No refresh token" errors common in DWD scenarios, automatically invalidating and refreshing tokens to ensure long-running scripts don't fail due to session expiration. The default `maxRetries` has also been increased to 9 to better handle transient network issues.
- **Form Submission Workaround:** Introduced a "Web Hack" for `FormApp` that allows submitting responses by scraping necessary metadata (like `fbzx` and `pageHistory`) from the published form. This works around the Google Forms API v1's lack of a direct submission endpoint.
- **Dependency Refresh:** Significant updates to core dependencies including `googleapis` (v171), `zod` (v4), and `into-stream` (v9) for improved performance and security.
